# 🔐 Basic認証の設定手順（Vercel）

このドキュメントでは、Vercelにデプロイされたアプリケーションに、IDとパスワードによるアクセス制限（Basic認証）を設定する方法を説明します。

## 📋 実装内容

以下のファイルが追加されました：

1. **`middleware.ts`** - Next.jsのミドルウェアファイル。全ページへのアクセスを保護します
2. **`.env.local`** - ローカル開発用の認証情報（ローカル環境のみ）
3. **`.gitignore`** - 認証情報をGitに含めないよう更新済み

## 🚀 Vercelでの設定手順

### ステップ1: Vercelダッシュボードにログイン

1. [Vercel](https://vercel.com/)にアクセスしてログインします
2. デプロイ済みのプロジェクトを選択します

### ステップ2: 環境変数の設定

1. プロジェクトページで **「Settings」** タブをクリック
2. 左サイドバーから **「Environment Variables」** を選択
3. 以下の2つの環境変数を追加します：

#### 環境変数1: ユーザー名

- **Variable Name**: `BASIC_AUTH_USER`
- **Value**: お好きなユーザー名（例: `admin`）
- **Environment**: 
  - ☑ Production
  - ☑ Preview
  - ☑ Development

**「Save」** をクリック

#### 環境変数2: パスワード

- **Variable Name**: `BASIC_AUTH_PASSWORD`
- **Value**: お好きなパスワード（**セキュアなパスワードを推奨**）
- **Environment**: 
  - ☑ Production
  - ☑ Preview
  - ☑ Development

**「Save」** をクリック

### ステップ3: 再デプロイ

環境変数を追加しただけでは反映されないため、再デプロイが必要です：

1. プロジェクトページの **「Deployments」** タブをクリック
2. 最新のデプロイメントの右側にある **「⋯」（3点メニュー）** をクリック
3. **「Redeploy」** を選択
4. 確認画面で **「Redeploy」** をクリック

または、以下の方法でも再デプロイできます：
- GitHubリポジトリに何らかの変更をpushする
- Vercelダッシュボードの「Deployments」から「Redeploy」を実行

### ステップ4: 動作確認

1. 再デプロイが完了したら、サイトのURLにアクセスします
2. **認証ダイアログ**が表示されます
3. 設定したユーザー名とパスワードを入力します
4. 正しい認証情報を入力すると、サイトにアクセスできます

## 🖼️ 設定画面のイメージ

### Environment Variables設定画面

```
Settings → Environment Variables

┌─────────────────────────────────────────────────────────┐
│ Environment Variables                                    │
├─────────────────────────────────────────────────────────┤
│ Variable Name: BASIC_AUTH_USER                          │
│ Value: admin                                             │
│ Environments: ☑ Production ☑ Preview ☑ Development     │
│                                              [Save]      │
├─────────────────────────────────────────────────────────┤
│ Variable Name: BASIC_AUTH_PASSWORD                      │
│ Value: ••••••••••••••••                                 │
│ Environments: ☑ Production ☑ Preview ☑ Development     │
│                                              [Save]      │
└─────────────────────────────────────────────────────────┘
```

## 🔒 セキュリティに関する重要な注意事項

### ✅ 推奨事項

- **強力なパスワードを使用する**: 英数字と記号を組み合わせた10文字以上のパスワードを推奨します
- **パスワードを定期的に変更する**: セキュリティのため、定期的に変更してください
- **認証情報を安全に保管する**: パスワードマネージャーなどを使用してください
- **必要な人にのみ共有する**: アクセスが必要な人にのみ認証情報を共有してください

### ❌ してはいけないこと

- ❌ 簡単なパスワード（例: `password`, `123456`）を使用しない
- ❌ 認証情報をGitHubなどのバージョン管理システムにコミットしない
- ❌ 認証情報を公開チャンネルで共有しない
- ❌ 複数のサービスで同じパスワードを使い回さない

## 💻 ローカル開発環境での確認方法

ローカルでBasic認証の動作を確認したい場合：

1. プロジェクトのルートディレクトリに `.env.local` ファイルがあります
2. 以下の内容が含まれています：

```env
BASIC_AUTH_USER=admin
BASIC_AUTH_PASSWORD=clinic-sales-2026
```

3. 開発サーバーを起動：

```bash
npm run dev
```

4. ブラウザで `http://localhost:3000` にアクセスすると認証ダイアログが表示されます

**注**: `.env.local` はローカル開発用で、Gitにはコミットされません。

## 🛠️ トラブルシューティング

### 認証ダイアログが表示されない

**原因**: 環境変数が反映されていない可能性があります

**解決方法**:
1. Vercelの「Settings」→「Environment Variables」で変数が正しく設定されているか確認
2. プロジェクトを再デプロイ
3. ブラウザのキャッシュをクリア（Ctrl+Shift+R）

### 正しいパスワードを入力しても認証失敗する

**原因**: パスワードにスペースや特殊文字が含まれている可能性があります

**解決方法**:
1. Vercelの環境変数設定を再確認
2. パスワードの前後にスペースがないか確認
3. 環境変数を一度削除して、再度追加してみる
4. 再デプロイ

### 認証を一時的に無効にしたい

**方法**:
1. Vercelの「Environment Variables」で `BASIC_AUTH_USER` と `BASIC_AUTH_PASSWORD` を削除
2. 再デプロイ

**注**: どちらか一方でも設定されていない場合、認証はスキップされます。

## 📝 認証情報の変更方法

パスワードを変更したい場合：

1. Vercelの「Settings」→「Environment Variables」にアクセス
2. `BASIC_AUTH_PASSWORD` の行の右側にある **「Edit」** をクリック
3. 新しいパスワードを入力して **「Save」** をクリック
4. プロジェクトを再デプロイ

## 🎯 設定完了チェックリスト

- [ ] Vercelに `BASIC_AUTH_USER` を設定した
- [ ] Vercelに `BASIC_AUTH_PASSWORD` を設定した
- [ ] 両方の環境変数で Production, Preview, Development にチェックを入れた
- [ ] プロジェクトを再デプロイした
- [ ] サイトにアクセスして認証ダイアログが表示されることを確認した
- [ ] 正しい認証情報でログインできることを確認した
- [ ] 認証情報を安全に保管した
- [ ] 必要な関係者に認証情報を共有した

## 📞 サポート

設定でお困りの場合は、以下の情報を添えてご連絡ください：

- Vercelのプロジェクト名
- エラーメッセージ（ある場合）
- 実行したステップ
- ブラウザのスクリーンショット（認証情報を除く）

---

**実装日**: 2026年1月23日  
**バージョン**: 1.0.0  
**対応フレームワーク**: Next.js 14

